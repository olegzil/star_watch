export DOCKER_BUILDKIT=1

eval $(ssh-agent) ### Make sure the ssh agent is running
ssh-add ~/.ssh/id_ed25519 ### Add the key file to the agent

### build with the id_ed25519 key so that git can clone the repo inside the docker image
docker build --rm --no-cache  --ssh starwatchsshkey=~/.ssh/id_ed25519 -t olegzilberman/star-watch-server:experimental.2 -f Dockerfile .

### Run the docker image
#docker run --rm -i -t -d -p 8080:8080 -p 443:443 -p 8443:8443 --init -v /mnt/disks/star-watch-data:/mnt/disks/star-watch-data --volume="$PWD/ssl:/etc/ssl/certs" --log-driver=syslog olegzilberman/star-watch-server:experimental.1
